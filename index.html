<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pong Oyunu</title>
    <style>
      body {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: #111;
        margin: 0;
        overflow: hidden; /* Ekrandaki fazlalƒ±k kaydƒ±rmayƒ± engelle */
      }
      canvas {
        background: #000;
        display: block;
        border: 2px solid #fff;
        width: min(
          800px,
          90vw
        ); /* Maksimum 800px veya ekran geni≈üliƒüinin %90'ƒ± */
        height: auto;
        aspect-ratio: 16 / 10; /* 16:10 oranƒ± koru */
      }
      .button-container {
        text-align: center;
        margin-top: 20px;
      }

      .game-btn {
        background: linear-gradient(135deg, #afaf40, #ac9537);
        border: none;
        color: white;
        padding: 12px 25px;
        margin: 0 10px;
        font-size: 18px;
        font-weight: bold;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      }

      .game-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 10px rgba(0, 0, 0, 0.4);
      }

      .game-btn:active {
        transform: translateY(1px);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>
  <body>
    <div>
      <canvas id="gameCanvas"></canvas>

      <div class="button-container">
        <button id="restartBtn" class="game-btn">üîÑYeniden Ba≈ülat</button>
        <button id="pauseBtn" class="game-btn">‚è∏Ô∏è Duraklat</button>
      </div>
    </div>

    <div
      id="levelMenu"
      style="
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        font-family: Arial;
        font-size: 24px;
        z-index: 10;
      "
    >
      <h1>Pong Oyunu</h1>
      <p>Zorluk seviyenizi se√ßin:</p>
      <div style="margin-top: 20px">
        <button class="game-btn" onclick="startGame('kolay')">Kolay</button>
        <button class="game-btn" onclick="startGame('orta')">Orta</button>
        <button class="game-btn" onclick="startGame('zor')">Zor</button>
      </div>
    </div>

    <audio id="bgMusic" src="sounds/backgroundMusic.mp3" loop autoplay></audio>
    <audio id="hitSound" src="sounds/scoreSound.mp3"></audio>
    <audio id="scoreSound" src="sounds/myGoal.mp3"></audio>
    <audio id="winGameSound" src="sounds/galibiyet.mp3"></audio>
    <audio id="loseGameSound" src="sounds/yenilgi.mp3"></audio>
    <audio id="buttonClickSound" src="sounds/tus-sesi.mp3"></audio>

    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");

      // Ses elemanlarƒ±nƒ± g√ºvenli bir ≈üekilde al ve hata yakalama ekle
      const getAudioElement = (id) => {
        const audioEl = document.getElementById(id);
        if (!audioEl) {
          console.error(`Hata: ID "${id}" olan ses elemanƒ± bulunamadƒ±.`);
          return null;
        }
        audioEl.addEventListener("error", (e) => {
          console.error(
            `Ses y√ºkleme hatasƒ±: ID "${id}", SRC: "${audioEl.src}"`,
            e
          );
        });
        return audioEl;
      };

      const hitSound = getAudioElement("hitSound");
      const scoreSound = getAudioElement("scoreSound");
      const winGameSound = getAudioElement("winGameSound");
      const loseGameSound = getAudioElement("loseGameSound");
      const bgMusic = getAudioElement("bgMusic");
      const buttonClickSound = getAudioElement("buttonClickSound");

      // Sesleri g√ºvenli bir ≈üekilde oynatan fonksiyon
      const playSound = (audioEl) => {
        if (audioEl) {
          try {
            audioEl
              .cloneNode(true)
              .play()
              .catch((e) => {
                console.error("Ses √ßalƒ±namadƒ±:", e);
              });
          } catch (e) {
            console.error("Ses √ßalma hatasƒ±:", e);
          }
        }
      };

      var gameOver = false;
      var isPaused = true;
      let upPressed = false,
        downPressed = false;
      let difficulty = "orta";
      let hitProbability = 1;

      // Oyun deƒüi≈ükenleri
      const game = {};
      const POWERUP_SPAWN_INTERVAL = 10000; // 10 saniye
      let lastPowerUpTime = 0;
      let powerup = null;
      let isComputerFrozen = false;

      // Toplarƒ± birden fazla top i√ßin bir diziye d√∂n√º≈üt√ºr
      let balls = [];

      // Yƒ±ldƒ±zlar i√ßin dizi
      let stars = [];

      function initializeGameElements() {
        // Canvas'ƒ±n g√ºncel boyutlarƒ±nƒ± al
        const canvasWidth = canvas.clientWidth;
        const canvasHeight = canvas.clientHeight;

        game.paddleWidth = canvasWidth * 0.0125;
        game.playerHeight = canvasHeight * 0.22;
        game.computerHeight = canvasHeight * 0.22;
        game.player = {
          x: canvasWidth * 0.025,
          y: canvasHeight / 2 - game.playerHeight / 2,
          score: 0,
          height: game.playerHeight,
        };
        game.computer = {
          x: canvasWidth - (canvasWidth * 0.025 + game.paddleWidth),
          y: canvasHeight / 2 - game.computerHeight / 2,
          score: 0,
          height: game.computerHeight,
        };

        // Tek top yerine bir dizi olu≈ütur
        balls = [
          {
            x: canvasWidth / 2,
            y: canvasHeight / 2,
            radius: canvasWidth * 0.01,
            dx: (canvasWidth / 800) * 5,
            dy: (canvasHeight / 500) * 5,
            baseSpeed: (canvasWidth / 800) * 5,
          },
        ];

        game.player.originalHeight = game.playerHeight; // Orijinal y√ºksekliƒüi sakla
        game.computer.originalHeight = game.computerHeight;

        // Yƒ±ldƒ±zlarƒ± olu≈ütur
        stars = [];
        for (let i = 0; i < 200; i++) {
          stars.push({
            x: Math.random() * canvasWidth,
            y: Math.random() * canvasHeight,
            radius: Math.random() * 2,
            speed: Math.random() * 0.5 + 0.1,
          });
        }
      }

      function setupCanvasSize() {
        canvas.width = canvas.clientWidth;
        canvas.height = canvas.clientHeight;
        initializeGameElements();
      }

      window.addEventListener("load", setupCanvasSize);
      window.addEventListener("resize", setupCanvasSize);

      // üéµ Ses seviyeleri ayarlandƒ±
      if (bgMusic) bgMusic.volume = 0.05;

      // Klavye olay dinleyicileri
      document.addEventListener("keydown", (e) => {
        if (bgMusic && bgMusic.paused)
          bgMusic.play().catch((e) => console.error("M√ºzik √ßalƒ±namadƒ±:", e));
        if (e.key === "ArrowUp") {
          upPressed = true;
        }
        if (e.key === "ArrowDown") {
          downPressed = true;
        }
      });

      document.addEventListener("keyup", (e) => {
        if (e.key === "ArrowUp") {
          upPressed = false;
        }
        if (e.key === "ArrowDown") {
          downPressed = false;
        }
      });

      // Dokunmatik olay dinleyicileri
      canvas.addEventListener("touchstart", (e) => {
        e.preventDefault(); // Varsayƒ±lan kaydƒ±rma hareketini engelle
        const touchY = e.touches[0].clientY;
        const canvasRect = canvas.getBoundingClientRect();

        // Dokunmanƒ±n canvas i√ßinde olup olmadƒ±ƒüƒ±nƒ± kontrol et
        if (touchY >= canvasRect.top && touchY <= canvasRect.bottom) {
          const relativeY = touchY - canvasRect.top;
          if (relativeY < canvas.height / 2) {
            upPressed = true;
            downPressed = false;
          } else {
            downPressed = true;
            upPressed = false;
          }
        }
      });

      canvas.addEventListener("touchend", (e) => {
        e.preventDefault();
        upPressed = false;
        downPressed = false;
      });

      canvas.addEventListener("touchcancel", (e) => {
        e.preventDefault();
        upPressed = false;
        downPressed = false;
      });

      // Butonlara tƒ±klama sesi ekle
      document.querySelectorAll(".game-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          playSound(buttonClickSound);
        });
      });

      document.getElementById("restartBtn").addEventListener("click", () => {
        document.getElementById("levelMenu").style.display = "flex";
        game.player.score = 0;
        game.computer.score = 0;
        initializeGameElements(); // Oyunu yeniden ba≈ülatƒ±rken elemanlarƒ± sƒ±fƒ±rla
        gameOver = false;
        isPaused = true;
        document.getElementById("pauseBtn").textContent = "‚è∏Ô∏è Duraklat";
      });

      document.getElementById("pauseBtn").addEventListener("click", () => {
        isPaused = !isPaused;
        document.getElementById("pauseBtn").textContent = isPaused
          ? "‚ñ∂Ô∏è Ba≈ülat"
          : "‚è∏Ô∏è Duraklat";
      });

      function startGame(level) {
        difficulty = level;
        document.getElementById("levelMenu").style.display = "none";
        game.player.score = 0;
        game.computer.score = 0;
        initializeGameElements();
        gameOver = false;
        isPaused = false;
        lastPowerUpTime = Date.now();

        if (level === "kolay") hitProbability = 0.3;
        else if (level === "orta") hitProbability = 0.5;
        else if (level === "zor") hitProbability = 0.9;

        if (bgMusic && bgMusic.paused)
          bgMusic.play().catch((e) => console.error("M√ºzik √ßalƒ±namadƒ±:", e));
      }

      function drawPaddle(x, y, height, isFrozen = false) {
        ctx.fillStyle = isFrozen ? "purple" : "red";
        ctx.fillRect(x, y, game.paddleWidth, height);
      }

      function drawBall(ball) {
        ctx.beginPath();
        ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
        ctx.fillStyle = "#fff";
        ctx.fill();
        ctx.closePath();
      }

      function drawScore() {
        ctx.font = `${canvas.height * 0.06}px Arial`;
        ctx.fillText(game.player.score, canvas.width / 4, canvas.height * 0.1);
        ctx.fillText(
          game.computer.score,
          (3 * canvas.width) / 4,
          canvas.height * 0.1
        );
      }

      function drawFirework(x, y) {
        for (let i = 0; i < 30; i++) {
          ctx.beginPath();
          ctx.arc(x, y, Math.random() * 4, 0, Math.PI * 2);
          ctx.fillStyle = `hsl(${Math.random() * 360}, 100%, 50%)`;
          ctx.fill();
          ctx.closePath();
        }
      }

      function drawPowerUp() {
        if (powerup) {
          ctx.beginPath();
          ctx.arc(powerup.x, powerup.y, powerup.radius, 0, Math.PI * 2);
          ctx.fillStyle = powerup.color;
          ctx.fill();
          ctx.closePath();
        }
      }

      function drawStarryBackground() {
        ctx.fillStyle = "black";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "white";
        stars.forEach((star) => {
          ctx.beginPath();
          ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
          ctx.fill();
          ctx.closePath();
        });
      }

      function resetBall(ball) {
        ball.x = canvas.width / 2;
        ball.y = canvas.height / 2;
        ball.dx *= -1;

        // Topun hƒ±zƒ±nƒ± arttƒ±r
        ball.dx += Math.sign(ball.dx) * (ball.baseSpeed * 0.1);
        ball.dy += Math.sign(ball.dy) * (ball.baseSpeed * 0.1);
      }

      function spawnPowerUp() {
        const types = ["widenPaddle", "freezeOpponent", "duplicateBall"];
        const type = types[Math.floor(Math.random() * types.length)];

        let color = "";
        switch (type) {
          case "widenPaddle":
            color = "green";
            break;
          case "freezeOpponent":
            color = "purple";
            break;
          case "duplicateBall":
            color = "cyan";
            break;
        }

        powerup = {
          x: Math.random() * (canvas.width / 2) + canvas.width / 4,
          y: Math.random() * (canvas.height / 2) + canvas.height / 4,
          radius: canvas.width * 0.02,
          type: type,
          color: color,
        };
      }

      function applyPowerUpEffect() {
        if (!powerup) return;

        switch (powerup.type) {
          case "widenPaddle":
            game.player.height = game.player.height * 1.5;
            setTimeout(() => {
              game.player.height = game.player.originalHeight;
            }, 5000); // 5 saniye sonra normale d√∂n
            break;
          case "freezeOpponent":
            isComputerFrozen = true;
            setTimeout(() => {
              isComputerFrozen = false;
            }, 5000); // 5 saniye sonra normale d√∂n
            break;
          case "duplicateBall":
            if (balls.length < 2) {
              const originalBall = balls[0];
              balls.push({
                x: originalBall.x,
                y: originalBall.y,
                radius: originalBall.radius,
                dx: -originalBall.dx,
                dy: -originalBall.dy,
              });
            }
            break;
        }

        powerup = null; // G√º√ßlendirmeyi t√ºket
        lastPowerUpTime = Date.now();
      }

      let lastTime = 0;
      function gameLoop(timestamp) {
        const deltaTime = (timestamp - lastTime) / 16.666;
        lastTime = timestamp;

        if (!isPaused) {
          update(deltaTime);
          draw();
        }
        requestAnimationFrame(gameLoop);
      }

      function update(deltaTime) {
        if (game.player.score >= 3 || game.computer.score >= 3) {
          if (!gameOver) {
            if (game.player.score >= 3) {
              playSound(winGameSound);
            } else {
              playSound(loseGameSound);
            }
            gameOver = true;
          }
          return;
        }

        // G√º√ßlendirme kontrol√º
        if (!powerup && Date.now() - lastPowerUpTime > POWERUP_SPAWN_INTERVAL) {
          spawnPowerUp();
        }

        // Yƒ±ldƒ±zlarƒ± g√ºncelle
        stars.forEach((star) => {
          star.x -= star.speed;
          if (star.x < 0) {
            star.x = canvas.width;
            star.y = Math.random() * canvas.height;
          }
        });

        // Oyuncu √ßubuƒüunu g√ºncelle
        const playerSpeed = 7;
        if (upPressed && game.player.y > 0) {
          game.player.y -= playerSpeed * deltaTime * (canvas.height / 500);
        }

        if (downPressed && game.player.y < canvas.height - game.player.height) {
          game.player.y += playerSpeed * deltaTime * (canvas.height / 500);
        }

        // Bilgisayar √ßubuƒüunu g√ºncelle (donuk deƒüilse)
        if (!isComputerFrozen) {
          if (Math.random() < hitProbability) {
            const targetY = balls[0].y - game.computer.height / 2;
            game.computer.y += (targetY - game.computer.y) * 0.1 * deltaTime;
          }
        }
        if (game.computer.y < 0) game.computer.y = 0;
        if (game.computer.y + game.computer.height > canvas.height)
          game.computer.y = canvas.height - game.computer.height;

        // Toplarƒ± g√ºncelle
        balls.forEach((ball, index) => {
          ball.x += ball.dx * deltaTime;
          ball.y += ball.dy * deltaTime;

          if (
            ball.y + ball.radius > canvas.height ||
            ball.y - ball.radius < 0
          ) {
            ball.dy *= -1;
          }

          // G√º√ßlendirme ile top √ßarpƒ±≈ümasƒ±
          if (powerup) {
            const distance = Math.hypot(ball.x - powerup.x, ball.y - powerup.y);
            if (distance < ball.radius + powerup.radius) {
              applyPowerUpEffect();
            }
          }

          // Oyuncu √ßubuƒüuyla √ßarpƒ±≈üma
          if (
            ball.x - ball.radius < game.player.x + game.paddleWidth &&
            ball.y > game.player.y &&
            ball.y < game.player.y + game.player.height
          ) {
            ball.dx *= -1;
            playSound(hitSound);
          }

          // Bilgisayar √ßubuƒüuyla √ßarpƒ±≈üma
          if (
            ball.x + ball.radius > game.computer.x &&
            ball.y > game.computer.y &&
            ball.y < game.computer.y + game.computer.height
          ) {
            ball.dx *= -1;
            playSound(hitSound);
          }

          // Sayƒ± atma
          if (ball.x < 0) {
            game.computer.score++;
            playSound(scoreSound);
            if (balls.length > 1) {
              balls.splice(index, 1);
              if (balls.length === 0) resetBall(balls[0]);
            } else {
              resetBall(balls[0]);
            }
          }
          if (ball.x > canvas.width) {
            game.player.score++;
            playSound(scoreSound);
            if (balls.length > 1) {
              balls.splice(index, 1);
              if (balls.length === 0) resetBall(balls[0]);
            } else {
              resetBall(balls[0]);
            }
          }
        });
      }

      function draw() {
        // ƒ∞lk olarak arka planƒ± √ßiz
        drawStarryBackground();

        if (gameOver) {
          ctx.font = `${canvas.height * 0.1}px Arial`;
          ctx.textAlign = "center";

          if (game.player.score >= 3) {
            ctx.fillStyle = "gold";
            ctx.fillText(
              "üèÜ SEN KAZANDIN!",
              canvas.width / 2,
              canvas.height / 2
            );
          } else {
            ctx.fillStyle = "red";
            ctx.fillText(
              "üíÄ Bƒ∞LGƒ∞SAYAR KAZANDI!",
              canvas.width / 2,
              canvas.height / 2
            );
          }

          if (game.player.score >= 3) {
            for (let i = 0; i < 20; i++) {
              drawFirework(
                Math.random() * canvas.width,
                Math.random() * canvas.height
              );
            }
          }
          return;
        }

        drawPaddle(game.player.x, game.player.y, game.player.height);
        drawPaddle(
          game.computer.x,
          game.computer.y,
          game.computer.height,
          isComputerFrozen
        );

        // T√ºm toplarƒ± √ßiz
        balls.forEach((ball) => drawBall(ball));

        drawScore();
        drawPowerUp();
      }

      requestAnimationFrame(gameLoop);
    </script>
  </body>
</html>
